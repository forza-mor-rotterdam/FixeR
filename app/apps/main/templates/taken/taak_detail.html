{% extends "base_modal_context.html" %}
{% load webpack_static from webpack_loader %}
{% load multiply previous next from list_tags %}
{% load taakopdracht render_onderwerp get_bijlagen from melding_tags %}
{% load to_date replace_comma_by_dot vind_in_dict from main_tags %}
{% load json_encode from main_tags %}
{% load mor_core_url from main_tags %}
{% load context_template from context_tags %}
{% load get_gebruiker_object_middels_email get_taakgebeurtenis_voor_taakstatus from gebruikers_tags %}
{% block title %}
    {% if TEMPLATE_BASIS != "benc" %}
        {{ melding.locatie.adres.straatNaam|lower|capfirst }}
        {% if melding.locatie.adres.huisnummer %}{{ melding.locatie.adres.huisnummer }}{% endif %}
    {% else %}
        {% with grafnummer=melding.locaties_voor_melding.0.grafnummer vak=melding.locaties_voor_melding.0.vak plaats=melding.locaties_voor_melding.0.begraafplaats %}
            {% if grafnummer %}Graf {{ grafnummer }}{% endif %}
            {% if vak %}, Vak {{ vak }}{% endif %}
            {% vind_in_dict melding.signalen_voor_melding.0.meta_uitgebreid.begraafplaats.choices plaats as signaal_begraafplaats_naam %}
            {% if signaal_begraafplaats_naam == melding.locaties_voor_melding.0.begraafplaats %}
                {% vind_in_dict melding.meta_uitgebreid.begraafplaats.choices plaats %}
            {% else %}
                {{ signaal_begraafplaats_naam }}
            {% endif %}
        {% endwith %}
    {% endif %}
{% endblock title %}
{% block before_modal_content %}
    <turbo-frame id="taak_basis">
    <div data-controller="modal">
        <div>
            <a href="{% url 'taken' %}"
               data-turbo-action="advance"
               class="link--back"
               aria-label="Terug">
                <svg width="25"
                     height="16"
                     viewBox="0 0 25 16"
                     fill="none"
                     xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.15173 1.73256L7.73753 0.318359L1.44704 6.60885L1.4142 6.576L0 7.9902L1.4115 9.4017L1.37867 9.43453L7.67186 15.7277L9.08606 14.3135L3.7726 9.00006H24.0098V7.00006H3.88423L9.15173 1.73256Z" fill="#404B4F" />
                </svg>
            </a>
        </div>
        <div data-controller="detail"
             data-detail-taak-object-value="{{ taak }}"
             data-detail-incident-y-value="{{ melding.locaties_voor_melding.0.geometrie.coordinates.0|replace_comma_by_dot }}"
             data-detail-incident-x-value="{{ melding.locaties_voor_melding.0.geometrie.coordinates.1|replace_comma_by_dot }}"
             data-detail-mercure-public-url-value="{{ APP_MERCURE_PUBLIC_URL }}"
             {% if not DEBUG %}data-detail-mercure-subscriber-token-value="{{ MERCURE_SUBSCRIBER_TOKEN }}"{% endif %}
             {% if taak.magAfhandelen %}class="has-sticky-footer"{% endif %}>
            <div class="taak-detail">
                <div class="container__header-taaknavigatie">
                    {% if TEMPLATE_BASIS != "benc" %}
                        <h1 class="h3">
                            {{ melding.locaties_voor_melding.0.straatnaam|lower|capfirst }}
                            {% if melding.locaties_voor_melding.0.huisnummer %}{{ melding.locaties_voor_melding.0.huisnummer }}{% endif %}
                            <span class="badge {% if taak.taakstatus.naam == 'nieuw' %}badge--darkblue {% elif taak.taakstatus.naam == 'toegewezen' %}badge--yellow {% else %}badge--green{% endif %}">{{ taak.taakstatus.naam|lower|capfirst }}
                                {% if taak.additionele_informatie.uitvoerder %}aan {{ taak.additionele_informatie.uitvoerder }}{% endif %}
                            </span>
                        </h1>
                    {% else %}
                        {% with grafnummer=melding.locaties_voor_melding.0.grafnummer vak=melding.locaties_voor_melding.0.vak plaats=melding.locaties_voor_melding.0.begraafplaats %}
                            <h1 class="h3">
                                {% if grafnummer %}Graf {{ grafnummer }}{% endif %}
                                {% if vak %}, Vak {{ vak }}{% endif %}
                                {% if not grafnummer and not vak and plaats %}
                                    {% vind_in_dict melding.signalen_voor_melding.0.meta_uitgebreid.begraafplaats.choices plaats as signaal_begraafplaats_naam %}
                                    {% if signaal_begraafplaats_naam == melding.locaties_voor_melding.0.begraafplaats %}
                                        {% vind_in_dict melding.meta_uitgebreid.begraafplaats.choices plaats %}
                                    {% else %}
                                        {{ signaal_begraafplaats_naam }}
                                    {% endif %}
                                {% endif %}
                                <span class="badge {% if taak.taakstatus.naam == 'nieuw' %}badge--darkblue {% elif taak.taakstatus.naam == 'toegewezen' %}badge--yellow {% else %}badge--green{% endif %}">{{ taak.taakstatus.naam|lower|capfirst }}
                                    {% if taak.additionele_informatie.uitvoerder %}aan {{ taak.additionele_informatie.uitvoerder }}{% endif %}
                                </span>
                            </h1>
                        {% endwith %}
                    {% endif %}
                    <div class="container__flex">
                        <div>
                            <span>{{ taak.titel }}</span>
                            <br>
                            <span class="lighter">
                                <span data-detail-target="taakAfstand"
                                      data-latitude="{{ taak.geometrie.coordinates.1|replace_comma_by_dot }}"
                                      data-longitude="{{ taak.geometrie.coordinates.0|replace_comma_by_dot }}"></span> meter afstand
                            </span>
                        </div>
                        <div class="textalign--right">
                            {% if device_os == "ios" %}
                                <small>
                                    <a class="link"
                                       href="http://maps.apple.com/?saddr=''&daddr={{ taak.geometrie.coordinates.1|replace_comma_by_dot }},{{ taak.geometrie.coordinates.0|replace_comma_by_dot }}&z=10&"
                                       target="_top"
                                       aria-label="Navigeer naar taak"
                                       data-detail-target="navigeerLink">
                                        {% include "icons/navigate.svg" %}
                                        Navigeren
                                    </a>
                                </small>
                            {% else %}
                                <a class="link"
                                   data-action="detail#makeRoute"
                                   data-detail-lat-param="{{ taak.geometrie.coordinates.1|replace_comma_by_dot }}"
                                   data-detail-long-param="{{ taak.geometrie.coordinates.0|replace_comma_by_dot }}"
                                   target="_top"
                                   aria-label="Navigeer naar taak">
                                    {% include "icons/navigate.svg" %}
                                    Navigeren
                                </a>
                            {% endif %}
                        </div>
                    </div>
                    {% comment %} <p>{{ taak.titel }}</p> {% endcomment %}
                    {% comment %} <div class="container__taaknavigatie" data-controller="taakNavigatie" data-taakNavigatie-taak-id-value="{{ taak.id }}" data-taakNavigatie-url-value="/taak/">
                    <span data-taakNavigatie-target="teller"></span>
                    <ul class="list__task-navigation">
                        <li>
                            <a class="previous" data-taakNavigatie-target="vorige">
                                <svg width="9" height="14" viewBox="0 0 9 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M5.99275 6.99995L0.689453 1.69665L1.75011 0.635986L8.11407 6.99995L1.75011 13.3639L0.689453 12.3032L5.99275 6.99995Z" fill="#00811F" />
                                </svg>
                            </a>
                        </li>
                        <li>
                            <a class="" data-taakNavigatie-target="volgende">
                                <svg width="9" height="14" viewBox="0 0 9 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd" clip-rule="evenodd" d="M5.99275 6.99995L0.689453 1.69665L1.75011 0.635986L8.11407 6.99995L1.75011 13.3639L0.689453 12.3032L5.99275 6.99995Z" fill="#00811F" />
                                </svg>
                            </a>
                        </li>
                    </ul>
                    </div> {% endcomment %}
                </div>
                {% get_bijlagen melding as bijlagen %}
                <section class="section--seperated"
                         data-testid="detailPhotoviewer"
                         {% if bijlagen|length < 2 %}style="border: 0;"{% endif %}>
                    <div class="full-width">
                        {% if bijlagen %}
                            <div class="container__imageslider"
                                 data-detail-target="imageSliderContainer"
                                 data-action="scroll->detail#onScrollSlider">
                                <ul class="list-clean imageslider"
                                    style="width: calc(100% * {{ bijlagen|length }})">
                                    {% for foto in bijlagen %}
                                        <li class="container__image"
                                            id="{{ foto.afbeelding_relative_url|mor_core_url }}">
                                            <img src="{{ foto.afbeelding_relative_url|mor_core_url }}"
                                                 alt=""
                                                 data-detail-target="selectedImage"
                                                 {% comment %}
                                                 data-action="click->detail#openImageInPopup"
                                                 {% endcomment %} />
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% if bijlagen|length > 1 %}
                                <div class="container__thumbs">
                                    <ul data-detail-target="thumbList">
                                        {% for foto in bijlagen %}
                                            <li data-action="click->detail#selectImage"
                                                data-detail-image-index-param="{{ forloop.counter }}">
                                                <div class="container__image">
                                                    <img src="{{ foto.afbeelding_verkleind_relative_url|mor_core_url }}"
                                                         alt="" />
                                                </div>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endif %}
                        {% else %}
                            <div class="no-image"
                                 style="background-image: url('{% webpack_static 'icons/noimage.svg' %}')"></div>
                        {% endif %}
                    </div>
                </section>
                <section data-testid="detailTaak">
                    <div class="container__details taak">
                        <details>
                            <summary>
                                <h2>
                                    <svg width="20"
                                         height="17"
                                         viewBox="0 0 55 43"
                                         fill="none"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M49.6439 0.0427246L23.0468 33.2845L4.96397 11.2844L0.317383 15.0798L23.0965 42.8261L54.3288 3.79295L49.6439 0.0427246Z" fill="#00811F" />
                                    </svg>
                                    Taak
                                    {% if taak.spoed %}<span><span class="icon icon--warning">Spoed</span></span>{% endif %}
                                </h2>
                            </summary>
                            {% if taak.titel %}
                                <h3 class="h5">Omschrijving</h3>
                                <p>{{ taak.titel }}</p>
                            {% endif %}
                            {% if taak.bericht %}
                                <h3 class="h5">Interne opmerking</h3>
                                <p>{{ taak.bericht }}</p>
                            {% endif %}
                            {% if taak.aangemaakt_op %}
                                <h3 class="h5">Aangemaakt</h3>
                                <p>{{ taak.aangemaakt_op|to_date|date:'d-m-Y H:i' }}<br>
                                {% with taakgebeurtenis=taak.taakgebeurtenissen_voor_taak|get_taakgebeurtenis_voor_taakstatus:'nieuw' %}
                                    {% include "incident/part_gebruiker_telefoon.html" with gebruiker=taakgebeurtenis.gebruiker|get_gebruiker_object_middels_email %}
                                {% endwith%}
                                </p>
                            {% endif %}
                            {% if taak.aangepast_op %}
                                {% if taak.aangepast_op|to_date|date:'d-m-Y H:i' != taak.aangemaakt_op|to_date|date:'d-m-Y H:i' and taak.aangepast_op|to_date|date:'d-m-Y H:i' != taak.afgesloten_op|to_date|date:'d-m-Y H:i' %}
                                    <h3 class="h5">Aangepast</h3>
                                    <p>{{ taak.aangepast_op|to_date|date:'d-m-Y H:i' }}</p>
                                {% endif %}
                            {% endif %}
                            {% if taak.afgesloten_op %}
                                <h3 class="h5">Afgesloten</h3>
                                <p>{{ taak.afgesloten_op|to_date|date:'d-m-Y H:i' }}<br>
                                {% with taakgebeurtenis=taak.taakgebeurtenissen_voor_taak|get_taakgebeurtenis_voor_taakstatus:'voltooid' %}
                                    {% include "incident/part_gebruiker_telefoon.html" with gebruiker=taakgebeurtenis.gebruiker|get_gebruiker_object_middels_email %}
                                {% endwith%}
                                </p>
                            {% endif %}
                            {% if taak.taakstatus %}
                                <h3 class="h5">Status</h3>
                                <p>{{ taak.taakstatus.naam }}</p>
                            {% endif %}
                            {% if taak.resolutie %}
                                <h3 class="h5">Resolutie</h3>
                                <p>{{ taak.resolutie }}</p>
                            {% endif %}
                        </details>
                        <details data-action="toggle->detail#toggleDetailLocatie">
                            <summary>
                                <h2>
                                    <svg width="20"
                                         height="26"
                                         viewBox="0 0 20 26"
                                         fill="none"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M17.6349 3.61281C16.709 2.48342 15.544 1.57355 14.224 0.948802C12.9039 0.324055 11.4617 0 10.0013 0C8.54084 0 7.09861 0.324055 5.77856 0.948802C4.4585 1.57355 3.29352 2.48342 2.3676 3.61281C0.837677 5.46838 0.000976563 7.79842 0.000976562 10.2034C0.000976563 12.6083 0.837677 14.9384 2.3676 16.7939L10.0013 26.0002L17.6361 16.7939C19.1652 14.938 20.0013 12.608 20.0011 10.2032C20.0009 7.79839 19.1644 5.46853 17.6349 3.61281ZM10.0001 13.9988C9.11016 13.9988 8.24017 13.7348 7.50017 13.2404C6.76018 12.746 6.18343 12.0432 5.84285 11.2209C5.50227 10.3987 5.41316 9.49394 5.58678 8.62106C5.76041 7.74818 6.18898 6.94639 6.81829 6.31708C7.4476 5.68777 8.24939 5.2592 9.12227 5.08557C9.99515 4.91195 10.8999 5.00106 11.7222 5.34164C12.5444 5.68222 13.2472 6.25897 13.7416 6.99897C14.2361 7.73896 14.5 8.60895 14.5 9.49893C14.5 10.6925 14.0259 11.8371 13.1821 12.6812C12.3382 13.5252 11.1937 13.9996 10.0001 13.9999V13.9988Z" fill="#00811F" />
                                    </svg>
                                    Locatie
                                </h2>
                            </summary>
                            {% if TEMPLATE_BASIS != "benc" %}
                                <div>
                                    {% comment %} <svg width="20" height="26" viewBox="0 0 20 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M17.6349 3.61281C16.709 2.48342 15.544 1.57355 14.224 0.948802C12.9039 0.324055 11.4617 0 10.0013 0C8.54084 0 7.09861 0.324055 5.77856 0.948802C4.4585 1.57355 3.29352 2.48342 2.3676 3.61281C0.837677 5.46838 0.000976563 7.79842 0.000976562 10.2034C0.000976563 12.6083 0.837677 14.9384 2.3676 16.7939L10.0013 26.0002L17.6361 16.7939C19.1652 14.938 20.0013 12.608 20.0011 10.2032C20.0009 7.79839 19.1644 5.46853 17.6349 3.61281ZM10.0001 13.9988C9.11016 13.9988 8.24017 13.7348 7.50017 13.2404C6.76018 12.746 6.18343 12.0432 5.84285 11.2209C5.50227 10.3987 5.41316 9.49394 5.58678 8.62106C5.76041 7.74818 6.18898 6.94639 6.81829 6.31708C7.4476 5.68777 8.24939 5.2592 9.12227 5.08557C9.99515 4.91195 10.8999 5.00106 11.7222 5.34164C12.5444 5.68222 13.2472 6.25897 13.7416 6.99897C14.2361 7.73896 14.5 8.60895 14.5 9.49893C14.5 10.6925 14.0259 11.8371 13.1821 12.6812C12.3382 13.5252 11.1937 13.9996 10.0001 13.9999V13.9988Z" fill="#00811F" />
                                    </svg> {% endcomment %}
                                    <h3 class="h5">Ter hoogte van:</h3>
                                    <p>
                                        {{ melding.locaties_voor_melding.0.straatnaam|lower|capfirst }}
                                        {% if melding.locaties_voor_melding.0.huisnummer %}
                                            {{ melding.locaties_voor_melding.0.huisnummer }}
                                        {% endif %}
                                    </p>
                                    {% if device_os == "ios" %}
                                        <small>
                                            <a class="link"
                                               href="http://maps.apple.com/?saddr=''&daddr={{ taak.geometrie.coordinates.1|replace_comma_by_dot }},{{ taak.geometrie.coordinates.0|replace_comma_by_dot }}&z=10&"
                                               target="_top"
                                               aria-label="Navigeer naar taak"
                                               data-detail-target="navigeerLink">
                                                {% include "icons/navigate.svg" %}
                                                Navigeren
                                            </a>
                                        </small>
                                    {% else %}
                                        <a class="link"
                                           data-action="detail#makeRoute"
                                           data-detail-lat-param="{{ taak.geometrie.coordinates.1|replace_comma_by_dot }}"
                                           data-detail-long-param="{{ taak.geometrie.coordinates.0|replace_comma_by_dot }}"
                                           target="_top"
                                           aria-label="Navigeer naar taak">
                                            {% include "icons/navigate.svg" %}
                                            Navigeren
                                        </a>
                                    {% endif %}
                                </div>
                                <dl>
                                    {% if melding.locaties_voor_melding.0.wijknaam %}
                                        <div>
                                            <dt>Wijk:</dt>
                                            <dd>
                                                {{ melding.locaties_voor_melding.0.wijknaam }}
                                            </dd>
                                        </div>
                                    {% endif %}
                                    {% if melding.locaties_voor_melding.0.buurtnaam %}
                                        <div>
                                            <dt>Buurt:</dt>
                                            <dd>
                                                {{ melding.locaties_voor_melding.0.buurtnaam }}
                                            </dd>
                                        </div>
                                    {% endif %}
                                    {% if taak.locatie.subbuurt %}
                                        <div>
                                            <dt>Subbuurt:</dt>
                                            <dd>
                                                {{ taak.locatie.subbuurt }}
                                            </dd>
                                        </div>
                                    {% endif %}
                                    {% if taak.locatie.plaatsbepaling %}
                                        <div>
                                            <dt>Plaatsbepaling:</dt>
                                            <dd>
                                                {{ taak.locatie.plaatsbepaling }}
                                            </dd>
                                        </div>
                                    {% endif %}
                                </dl>
                                <div class="container__map full-width">
                                    <div class="map map--single"
                                         id="incidentMap"
                                         data-action="touchstart->detail#onTwoFingerDrag touchend->detail#onTwoFingerDrag">
                                        <div class="map__overlay">
                                            <span>Gebruik twee vingers om de kaart te verplaatsen</span>
                                        </div>
                                    </div>
                                </div>
                            {% else %}
                                {% with grafnummer=melding.locaties_voor_melding.0.grafnummer vak=melding.locaties_voor_melding.0.vak plaats=melding.locaties_voor_melding.0.begraafplaats %}
                                    <h3 class="h5">Begraafplaats</h3>
                                    <p>
                                        {% vind_in_dict melding.signalen_voor_melding.0.meta_uitgebreid.begraafplaats.choices plaats as signaal_begraafplaats_naam %}
                                        {% if signaal_begraafplaats_naam == melding.locaties_voor_melding.0.begraafplaats %}
                                            {% vind_in_dict melding.meta_uitgebreid.begraafplaats.choices plaats %}
                                        {% else %}
                                            {{ signaal_begraafplaats_naam }}
                                        {% endif %}
                                    </p>
                                    {% if melding.locaties_voor_melding.0.grafnummer %}
                                        <h3 class="h5">Grafnummer</h3>
                                        <p>{{ melding.locaties_voor_melding.0.grafnummer }}</p>
                                    {% endif %}
                                    {% if melding.locaties_voor_melding.0.vak %}
                                        <h3 class="h5">Vak</h3>
                                        <p>{{ melding.locaties_voor_melding.0.vak }}</p>
                                    {% endif %}
                                    {% if melding.signalen_voor_melding.0.meta.naam_overledene %}
                                        <h3 class="h5">Naam overledene</h3>
                                        <p>{{ melding.signalen_voor_melding.0.meta.naam_overledene }}</p>
                                    {% elif melding.meta.naam_overledene %}
                                        <h3 class="h5">Naam overledene</h3>
                                        <p>{{ melding.meta.naam_overledene }}</p>
                                    {% endif %}
                                {% endwith %}
                            {% endif %}
                        </details>
                        <details>
                            <summary>
                                <h2>
                                    <svg width="20"
                                         height="22"
                                         viewBox="0 0 20 22"
                                         fill="none"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M4 4H7V6H4V4Z" fill="#00811F" />
                                        <path d="M7 8H4V10H7V8Z" fill="#00811F" />
                                        <path d="M4 12H7V14H4V12Z" fill="#00811F" />
                                        <path d="M7 16H4V18H7V16Z" fill="#00811F" />
                                        <path d="M8 4H16V6H8V4Z" fill="#00811F" />
                                        <path d="M16 8H8V10H16V8Z" fill="#00811F" />
                                        <path d="M8 12H16V14H8V12Z" fill="#00811F" />
                                        <path d="M16 16H8V18H16V16Z" fill="#00811F" />
                                        <path fill-rule="evenodd" clip-rule="evenodd" d="M0 0V22H20V0H0ZM18 2H2V20H18V2Z" fill="#00811F" />
                                    </svg>
                                    Melding
                                </h2>
                            </summary>
                            <h3 class="h5">Nummer</h3>
                            <p>{{ melding.id }}</p>
                            <h3 class="h5">Ingediend</h3>
                            <p>{{ melding.aangemaakt_op|to_date|date:'d-m-Y H:i' }}</p>
                            {% if melding.meta.aannemer %}
                                <h3 class="h5">Aangenomen door</h3>
                                <p>{{ melding.meta.aannemer }}</p>
                            {% endif %}
                            {% if melding.onderwerpen %}
                                <h3 class="h5">Onderwerp</h3>
                                <p>
                                    {% for onderwerp in melding.onderwerpen %}
                                        <turbo-frame id="onderwerp_{{ onderwerp|urlencode }}" data-spinner="hide" loading="lazy" src="{% url 'onderwerp' %}?url={{ onderwerp|urlencode }}"></turbo-frame>
                                        {% if not forloop.last %},{% endif %}
                                    {% endfor %}
                                </p>
                            {% endif %}
                            {% if melding.omschrijving_kort %}
                                <h3 class="h5">Toelichting kort</h3>
                                <p>{{ melding.omschrijving_kort }}</p>
                            {% endif %}
                            {% if melding.omschrijving %}
                                <h3 class="h5">Toelichting</h3>
                                <p>{{ melding.omschrijving }}</p>
                            {% endif %}
                            {% if melding.afdeling.omschrijving %}
                                <h3 class="h5">Afdeling</h3>
                                <p>
                                    {{ melding.afdeling.omschrijving }}
                                    {{ melding.afdeling.omschrijving }}
                                </p>
                            {% endif %}
                        </details>
                        <details>
                            <summary>
                                <h2>
                                    <svg width="21"
                                         height="22"
                                         viewBox="0 0 21 22"
                                         fill="none"
                                         xmlns="http://www.w3.org/2000/svg">
                                        <path d="M19.0009 11C19.0009 15.9706 14.9715 20 10.0009 20C6.96008 20 4.27145 18.4919 2.64218 16.1829L0.953125 17.2577C2.93876 20.1233 6.25068 22 10.0009 22C16.0761 22 21.0009 17.0751 21.0009 11C21.0009 4.92487 16.0761 0 10.0009 0C6.96339 0 4.21339 1.23121 2.22279 3.22181L1.00098 2V6H5.00098L3.637 4.63602C5.26568 3.00735 7.51567 2 10.0009 2C14.9715 2 19.0009 6.02944 19.0009 11Z" fill="#00811F" />
                                        <path d="M9.00098 5H11.001V11.8573L15.1973 14.28L14.1973 16.0121L9.00098 13V5Z" fill="#00811F" />
                                    </svg>
                                    Tijdlijn
                                </h2>
                            </summary>
                            {% include "incident/part_tijdlijn.html" %}
                        </details>
                    </div>
                </section>
                {% context_template "taak_afhandelen_subtitel.html" as subtitel_template %}
                <section class="section--seperated section--seperated__no-border-bottom"
                         data-testid="detailActions">
                    <div class="container__details container__details--sticky-bottom">
                        {% if not taak.afgesloten_op %}
                            <div class="sticky sticky--bottom">
                                <div class="form-row">
                                    <button class="btn btn-action" data-modal-title-param="Taak afhandelen" data-modal-sub-title-param="<strong>
                                        {% include subtitel_template %}
                                    </strong>
                                    <br>
                                    {{ taak.titel }}" data-modal-url-param="{% url 'incident_modal_handle_part' taak.id %}" data-modal-id-param="incident_modal_handle_{{ taak.id }}" data-action="modal#openModal">
                                    Taak afhandelen
                                </button>
                                {% if taak.taakstatus.naam == "openstaand" or taak.taakstatus.naam == "nieuw" %}
                                    {% if perms.authorisatie.taak_toewijzen %}
                                        <button class="btn btn-tertiary" data-modal-title-param="Toewijzen" data-modal-sub-title-param="<strong>
                                            {% include subtitel_template %}
                                        </strong>
                                        <br>
                                        {{ taak.titel }}" data-modal-url-param="{% url 'taak_toewijzen' taak.id %}" data-modal-id-param="taak_toewijzen" data-action="modal#openModal">
                                        Toewijzen
                                    </button>
                                {% endif %}
                            {% elif taak.taakstatus.naam == "toegewezen" and perms.authorisatie.taak_toewijzing_intrekken %}
                                {% if perms.authorisatie.taak_toewijzing_intrekken %}
                                    <button class="btn btn-tertiary" data-id="{{ taak.id }}" data-modal-title-param="Toewijzing intrekken" data-modal-sub-title-param="<strong>
                                        {% include subtitel_template %}
                                    </strong>
                                    <br>
                                    {{ taak.titel }}" data-modal-url-param="{% url 'taak_toewijzing_intrekken' taak.id %}" data-modal-id-param="taak_toewijzing_intrekken" data-action="modal#openModal">
                                    Toewijzing intrekken
                                </button>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        </div>
    </section>
</div>
{% comment %} <div class="modal modal--transparent">
                <div class="modal-dialog">
                    <div class="modal-backdrop modal-exit" data-action="click->modal#closeModal"></div>
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="btn-close" aria-label="Sluit" data-action="modal#closeModal"></button>
                        </div>
                        <div class="modal-body">
                            <div id="container-image"></div>
                        </div>
                    </div>
                </div>
</div> {% endcomment %}
{% endblock before_modal_content %}
{% block after_modal_content %}
</div>
</div>
</turbo-frame>
{% endblock after_modal_content %}
