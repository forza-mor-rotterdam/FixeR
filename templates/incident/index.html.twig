{% extends 'base.html.twig' %}

{% block title %}Meldingen{% endblock %}

{% block body %}

    <h1>Meldingen ({{ incidents | length }})</h1>
    <a data-modal="modal-one">Open Modal</a>
    <ul 
        class="list__incidents" 
        data-testid="IncidentsList" 
        >
        {% for incident in incidents %}
        <li
            data-controller="incident" 
            data-action="click->incident#swipe"
            data-incident-id-value="{{ incident.id }}">
            <div class="wrapper__swipe">
                <div class="container__flex">
                    <a href="/incident/{{ incident.id }}">
                        <div class="container__image">
                            {% if incident._detail is defined and incident._detail.fotos %}
                            <div class="background-image" style="background-image: url('{{ path('app_image_full', {'id': incident._detail.fotos|first.id}) }}')"></div>
                            {% else %}
                                <div class="background-image" style="background-image: url('{{ asset('build/images/logo-rotterdam.svg') }}'); background-size: 80%;"></div>
                            {% endif %}
                        </div>
                    </a>
                    <div class="container__info">
                    {# TODO add optional huisletter and huisnummer_toevoeging  #}
                        {# <a href="/incident/{{ incident.id }}/handle"> #}
                            <h2>{{ incident.locatie.adres.straatNaam }} {{ incident.locatie.adres.huisnummer }}</h2>
                            <span class="incident__category">
                                {{ incident.onderwerp.omschrijving }} - {{ incident.status }}
                            </span>
                            <div class="incident__moment">
                                <span>{{ incident.id }}</span>
                                <span>
                                    {{ incident.datumMelding | date('d-m-Y') }} 
                                    {{ incident.datumMelding | date('H:i') }}
                                </span>
                            </div>
                        {# </a> #}
                    </div>
                </div>
            </div>
            <button
                class="container__actions"
                data-id="{{ incident.id }}"
                data-incident-object-param = "{{ incident|json_encode() }}"
                data-action="click->incident#openModal"
            >
                <img src="{{ asset('build/icons/checkmark.svg') }}" width="20" alt="" class="checkmark-handle" id="checkMarkHandle"/>
            </button>
        </li>
        {% endfor %}
    </ul>
    
    <div class="modal" id="modal-one">
        <div class="modal-dialog">
            <div class="modal-backdrop modal-exit" id="modal-backdrop"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h1>
                        Melding afhandelen<br>
                        {# <small>{{ incident.locatie.adres.straatNaam }} {{ incident.locatie.adres.huisnummer }}</small> #}
                        <small>...</small>
                    </h1>
                    <button type="button" class="btn-close modal-exit" aria-label="Sluit"></button>    
                </div>
                <div class="modal-body">
                    {# {% if incident is defined %} #}
                    <div class="container__form" 
                        data-controller="getGroups"
                        {# data-getGroups-group-selected-value = "{{ incident.afdeling.omschrijving }}"
                        data-getGroups-group-list-value =  "{{ groupedSubjects|json_encode() }}" #}
                        data-getGroups-group-selected-value = "1"
                        data-getGroups-group-list-value =  "..."
                    >
                        <form action="" method="post" data-testid="handleIncidentForm">
                            <div class="form-row">
                                <label htmlFor="group">Groep</label>
                                <select
                                    class="form-control form-select"
                                    name="groupList"
                                    id="groupList"
                                    data-getGroups-target="groupList"
                                    data-action="change->getGroups#setSubjects"
                                    {# data-getGroups-selectedGroup-param="" #}
                                ></select>
                            </div>

                            <div class="form-row">
                                <label htmlFor="subject">Onderwerp</label>
                                <select
                                    class="form-control form-select"
                                    name="subjectList"
                                    id="subjectList"
                                    data-getGroups-target="subjectList"
                                ></select>
                            </div>

                            <div class="form-row">
                                <label htmlFor="messageSelector">Tekst voor melder</label>
                                <input
                                    class="form-control"
                                    data-testid="messageSelector"
                                    id="messageSelector"
                                    name="messageSelector"
                                    value="Afval weggehaald"
                                    type="text"
                                />
                            </div>
                            <div class="form-row">
                                <textarea
                                    class="form-control"
                                    data-testid="message"
                                    id="message"
                                    name="message"
                                    rows="4"
                                >Beste melder, Ons team heeft het afval weggehaald. Bedankt voor uw hulp.
                                </textarea>
                            </div>
                            <div class="form-row container__button">
                                <button type="reset" class="btn btn-tertiary" onclick="window.history.go(-1); return false;"><span>Annuleren</span></button>
                                {# TODO make it a submit button when we are not testing on production #}
                                <button type="reset" class="btn btn-action"><span>Afhandelen</span></button>
                            </div>
                        </form>
                    </div>
                    {# {% endif %} #}
                </div>
            </div>
        </div>
    </div>

{% endblock %}
