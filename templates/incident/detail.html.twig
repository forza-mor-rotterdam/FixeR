{% extends 'base.html.twig' %}

{% block title %}{{ incident.locatie.adres.straatNaam }} {{ incident.locatie.adres.huisnummer }}{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI="
        crossorigin=""/>
{% endblock %}

{% block javascripts %}
    {{ parent()}}
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
        integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM="
        crossorigin=""></script>
{% endblock %}

{% block body %}

<div 
    data-controller="detail"
    data-detail-incident-x-value="{{ incident.locatie.x }}"
    data-detail-incident-y-value="{{ incident.locatie.y }}"
    data-detail-area-list-value="{{ areas|json_encode() }}"
    data-detail-current-district-value="{{ incident.locatie.buurtNummer }}"
>
    <section class="section--seperated" data-testid="detailPhotoviewer">
        <div class="full-width">
        {% if incident.fotos|length > 0 %}
            <div class="container__imageslider">
                <div class="container__image">
                    <img src="{{ path('app_image_full', {'id': incident.fotos|first.id}) }}" alt="" data-detail-target="selectedImage" />
                </div>
                {% if incident.fotos|length > 1 %}
                <div class="container__thumbs">
                    <ul 
                        data-detail-target="thumbList">
                        {% for foto in incident.fotos %}
                        <li 
                            data-action="click->detail#selectImage"
                            data-detail-image-source-param="{{ path('app_image_full', {'id': foto.id}) }}"
                        >
                            <div class="container__image">
                                <img src="{{ path('app_image_thumbnail', {'id': foto.id}) }}" alt="" data-detail-target="selectedThumb" />
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>
        {% else %}
            <div class="no-image" style="background-image: url('{{ asset('build/icons/noimage.svg') }}');"></div>
        {% endif %}
        </div>
    </section>

    <section class="section--seperated"  data-testid="detailAbout">
        <div class="container__details">
        {# TODO add optional huisletter and huisnummer_toevoeging  #}
            <h1 class="h3">{{ incident.locatie.adres.straatNaam }} {{ incident.locatie.adres.huisnummer }}</h1>
            <span>
                {{ incident.datumMelding | date('d-m-Y') }} 
                {{ incident.datumMelding | date('H:i') }}
            </span>

            <h2 class="h5">Omschrijving</h2>
            <p>
                {% if incident.omschrijving %}
                    {{ incident.omschrijving }}
                {% else %}
                    -
                {% endif %}
            </p>
            <h2 class="h5">Onderwerp</h2>
            <p>
                {% if incident.onderwerp.omschrijving %}
                    {{ incident.onderwerp.omschrijving }}
                {% else %}
                    -
                {% endif %}
            </p>
            <h2 class="h5">Afdeling</h2>
            <p>
                {% if incident.afdeling.omschrijving %}
                    {{ incident.afdeling.omschrijving }}
                {% else %}
                    -
                {% endif %}
            </p>

            <h2 class="h5">Melding {{ incident.id }}</h2>
            <p>
                {% if incident.status %}
                    Status: {{ incident.status }}
                {% else %}
                    Status: -
                {% endif %}
            </p>

        </div>
    </section>

    <section class="section--seperated" data-testid="detailLocation">
        <div class="container__details">
            <h2 class="h5">Locatie</h2>
            <p>
                <a href="#" class="link--location">{{ incident.locatie.adres.straatNaam }} {{ incident.locatie.adres.huisnummer }}</a>
            </p>
            <dl>
                <div>
                    <dt>Wijk:</dt>
                    <dd data-detail-target="area"></dd>
                </div>
                <div>
                    <dt>Buurt:</dt>
                    <dd data-detail-target="district"></dd>
                </div>
                {% if incident.locatie.subbuurt %}
                <div>
                    <dt>Subbuurt:</dt>
                    <dd>{{ incident.locatie.subbuurt }}</dd>
                </div>
                {% endif %}
                {% if incident.locatie.plaatsbepaling %}
                <div>
                    <dt>Plaatsbepaling:</dt>
                    <dd>{{ incident.locatie.plaatsbepaling }}</dd>
                </div>
                {% endif %}
            </dl>
            <div class="container__map full-width" id="incidentMap">
            </div>
        </div>
    </section>

    <section class="section--seperated" data-testid="detailReporter">
        <div class="container__details">
            <h2 class="h5">Gemeld door</h2>
            <ul class="list-clean incident-meta-list">
                {% if incident.melder.herkomst|default %}
                <li>
                    <p class="text--person">{{ incident.melder.herkomst }}</p>
                </li>
                {% endif %}
                {% if incident.melder.telefoon|default %}
                <li>
                    <a href="tel:{{ incident.melder.telefoon }}" class="link--phone">{{ incident.melder.telefoon }}</a>
                </li>
                {% endif %}
                {% if incident.melder.email|default %}
                <li>
                    <a href="mailto:{{ incident.melder.email }}" class="link--email">{{ incident.melder.email }}</a>
                </li>
                {% endif %}
                {% if incident.melder.informeren is same as("Nee") %}
                <li>
                    <p class="text--close">De melder wil niet op de hoogte blijven</p>
                </li>
                {% endif %}
            </ul>
        </div>
    </section>

    <section class="section--seperated" data-testid="detailActions">
        <div class="container__details">
            <ul class="list-clean incident-meta-list">
                <li>
                    <a href="#" class="link--file-text">Mutatieregels</a>
                </li>
                <li>
                    <a href="#" class="link--file">Bestanden</a>
                </li>
                {% if incident.magInBehandelingNemen %}
                <li>
                    <a href="#" class="link--next">In behandeling nemen</a>
                </li>
                {% endif %}
                {% if incident.magDoorsturenMelddesk %}
                <li>
                    <a href="#" class="link--next">Doorsturen</a>
                </li>
                {% endif %}
            </ul>
            {% if incident.magAfhandelen %}
                <div class="form-row" data-controller="incident" >
                    <button 
                        class="btn btn-action"
                        data-id="{{ incident.id }}"
                        data-incident-object-param = "{{ incident|json_encode() }}"
                        data-action="click->incident#openModal"
                    >
                        Afhandelen
                    </button>
                </div>
            {% endif %}
            {% if incident.magDoorverwijzen %}
                <div class="form-row">
                    <button class="btn btn-tertiary">Doorverwijzen</button>
                </div>
            {% endif %}
        </div>
    </section>
</div>
{% include('./snippets/modal_form_handle.html.twig') %}
{% endblock %}
